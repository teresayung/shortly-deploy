var db=require("../config"),Link=require("../models/link"),Links=new db.Collection;Links.model=Link,module.exports=Links;var db=require("../config"),User=require("../models/user"),Users=new db.Collection;Users.model=User,module.exports=Users;var db=require("../config"),crypto=require("crypto"),Link=db.Model.extend({tableName:"urls",hasTimestamps:!0,defaults:{visits:0},initialize:function(){this.on("creating",function(a){var b=crypto.createHash("sha1");b.update(a.get("url")),a.set("code",b.digest("hex").slice(0,5))})}});module.exports=Link;var db=require("../config"),bcrypt=require("bcrypt-nodejs"),Promise=require("bluebird"),User=db.Model.extend({tableName:"users",hasTimestamps:!0,initialize:function(){this.on("creating",this.hashPassword)},comparePassword:function(a,b){bcrypt.compare(a,this.get("password"),function(a,c){b(c)})},hashPassword:function(){var a=Promise.promisify(bcrypt.hash);return a(this.get("password"),null,null).bind(this).then(function(a){this.set("password",a)})}});module.exports=User;var express=require("express"),partials=require("express-partials"),util=require("./lib/utility"),handler=require("./lib/request-handler"),app=express();app.configure(function(){app.set("views",__dirname+"/views"),app.set("view engine","ejs"),app.use(partials()),app.use(express.bodyParser()),app.use(express.static(__dirname+"/public")),app.use(express.cookieParser("shhhh, very secret")),app.use(express.session())}),app.get("/",util.checkUser,handler.renderIndex),app.get("/create",util.checkUser,handler.renderIndex),app.get("/links",util.checkUser,handler.fetchLinks),app.post("/links",handler.saveLink),app.get("/login",handler.loginUserForm),app.post("/login",handler.loginUser),app.get("/logout",handler.logoutUser),app.get("/signup",handler.signupUserForm),app.post("/signup",handler.signupUser),app.get("/*",handler.navToLink),module.exports=app;var app=require("./server-config.js"),port=process.env.port||4568;app.listen(port),console.log("Server now listening on port "+port);